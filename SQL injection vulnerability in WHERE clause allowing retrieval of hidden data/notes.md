### Lab: SQL injection vulnerability in WHERE clause allowing retrieval of hidden data
#### Level: APPRENTICE
<br>

----

<br>

 ```
This lab contains an SQL injection vulnerability in the product category filter. 
When the user selects a category, the application carries out an SQL query like the following:

SELECT * FROM products WHERE category = 'Gifts' AND released = 1

To solve the lab, perform an SQL injection attack that causes 
the application to display details of all products in any category, both released and unreleased.
```

----



* SQL Injection vulnerability: `Product category filter.`

* Query : `SELECT * FROM products WHERE category = 'Gifts' AND released = 1`

* End Goal: `Display all the released and unreleased products.`


----

### Analysis:

* When you click on any filter, it takes that filter as the parameter value and processes the request, and sends back the response.

* If we click on the `Gifts` category, it takes Gifts as the value of the parameter and processes the request, then sends all the products that come under the `Gifts` category as the response.

The URL appears like this 
`https://acb21ff71f913b67c00b3b2600e400b4.web-security-academy.net/filter?category=Gifts`

#### Backend Process: 

</br>

* Products Table
</br>


 Product_ID |                    Product_Name                    | Price | category | released |
| :--: | :----------------------------------------: | :-------: |:-------: |:-------: |
|  1   | Conversation Controlling Lemon |   $74.41    | Gifts | 1 |
|  2   | Giant Pillow Thing |   $42.79    |Accessories | 1 |
|  3   | Conversation Controlling Lemon |   $74.41    | Gifts | 0 |
|  4   | Babbage Web Spray |   $79.20    | Pets | 1 |
|  5   | Snow Delivered To Your Door |   $65.95   | Gifts | 1 |
|  6   | Baby Minding Shoes |   $74.41    | Clothing, shoes and accessories | 0 |
|  7   | Vintage Neck Defender |   $99.82    | Gifts | 1 |
|  8   | Fur Babies |   $70.37   | Pets | 1 |
|  9   | Cheshire Cat Grin |   $51.71    |Accessories | 0 |
|  10   | Paddling Pool Shoes |   $8.70    | Clothing, shoes and accessories | 1 |

</br>

* When we select the `Gifts` category in the backend, the following query will run `SELECT * FROM products WHERE category = 'Gifts' AND released = 1`.

* So it will select all the data from the Products table where the category column value is `"Gifts"` and released column value is `"1"` and send the data to the browser.

 Product_ID |                    Product_Name                    | Price | category | released |
| :--: | :----------------------------------------: | :-------: |:-------: |:-------: |
|  1   | Conversation Controlling Lemon |   $74.41    | Gifts | 1 |
|  7   | Vintage Neck Defender |   $99.82    | Gifts | 1 |


</br>

* Instead of sending the parameter value as the category, we will send a payload that throws an SQL Error.
* We can use `'` or `"` to get an error.
* Then the query looks like this `SELECT * FROM products WHERE category = ''' AND released = 1`
* When we keep a single quote, then the backend thinks the string ends there, and after that, when it sees the following single quote, It doesn't know what to do, So it throws an error.
* If we get an error back, we can check for SQL Injection.

</br>

#### Solution :

* To retrieve all the products, we use the following payload.

* Payload: `' or 1=1 --`
* The `'` single quote ends the string, and the query looks like this `SELECT * FROM products WHERE category = '' AND released = 1`.
* This returns a false value, so the other condition, ` 1=1`, is always true, so it returns all the data to the browser.
* But still, we don't get any data because it's checking for the column released = 1, so we use `--` to comment on the rest of the query.
* The final query looks like this `SELECT * FROM products WHERE category = '' or 1=1 --' AND released = 1`.
